{"ast":null,"code":"import { computed } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { HabitService } from '../../core/services/habit.service';\nimport { FirebaseService } from '../../core/services/firebase.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../core/services/habit.service\";\nimport * as i2 from \"../../core/services/firebase.service\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction WeeklyReflectionComponent_div_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"div\", 12)(2, \"div\", 13);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 14);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 15);\n    i0.ɵɵelement(7, \"div\", 16);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"div\", 17);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const habit_r2 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(habit_r2.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r0.getHabitWeeklyVotes(habit_r2.id), \"/7\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"width\", ctx_r0.getHabitWeeklyVotes(habit_r2.id) / 7 * 100, \"%\")(\"background\", habit_r2.color);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(habit_r2.identity);\n  }\n}\nfunction WeeklyReflectionComponent_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 18)(1, \"h3\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 19)(4, \"label\");\n    i0.ɵɵtext(5, \"What helped you show up this week?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"textarea\", 20);\n    i0.ɵɵlistener(\"ngModelChange\", function WeeklyReflectionComponent_div_29_Template_textarea_ngModelChange_6_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const habit_r3 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r4.reflections[habit_r3.id].whatHelped = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 19)(8, \"label\");\n    i0.ɵɵtext(9, \"What obstacles did you face?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"textarea\", 20);\n    i0.ɵɵlistener(\"ngModelChange\", function WeeklyReflectionComponent_div_29_Template_textarea_ngModelChange_10_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const habit_r3 = restoredCtx.$implicit;\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.reflections[habit_r3.id].obstacles = $event);\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"div\", 19)(12, \"label\");\n    i0.ɵɵtext(13, \"What will you adjust next week?\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"textarea\", 20);\n    i0.ɵɵlistener(\"ngModelChange\", function WeeklyReflectionComponent_div_29_Template_textarea_ngModelChange_14_listener($event) {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const habit_r3 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.reflections[habit_r3.id].adjustments = $event);\n    });\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const habit_r3 = ctx.$implicit;\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(habit_r3.name);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.reflections[habit_r3.id].whatHelped);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.reflections[habit_r3.id].obstacles);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.reflections[habit_r3.id].adjustments);\n  }\n}\nexport let WeeklyReflectionComponent = /*#__PURE__*/(() => {\n  class WeeklyReflectionComponent {\n    constructor(habitService, firebase) {\n      this.habitService = habitService;\n      this.firebase = firebase;\n      this.habits = computed(() => this.habitService.allHabits());\n      this.reflections = {};\n      this.habits().forEach(habit => {\n        this.reflections[habit.id] = {\n          whatHelped: '',\n          obstacles: '',\n          adjustments: ''\n        };\n      });\n    }\n    totalVotes() {\n      return this.habits().reduce((sum, habit) => {\n        return sum + this.getHabitWeeklyVotes(habit.id);\n      }, 0);\n    }\n    consistencyRate() {\n      const total = this.habits().length * 7;\n      if (total === 0) return 0;\n      return Math.round(this.totalVotes() / total * 100);\n    }\n    bestStreak() {\n      let maxStreak = 0;\n      this.habits().forEach(habit => {\n        const streak = this.getHabitWeeklyVotes(habit.id);\n        if (streak > maxStreak) maxStreak = streak;\n      });\n      return maxStreak;\n    }\n    getHabitWeeklyVotes(habitId) {\n      let count = 0;\n      for (let i = 0; i < 7; i++) {\n        const date = new Date();\n        date.setDate(date.getDate() - i);\n        const dateStr = date.toISOString().split('T')[0];\n        if (this.habitService.getHabitState(habitId, dateStr) === 'done') {\n          count++;\n        }\n      }\n      return count;\n    }\n    saveReflection() {\n      const date = new Date().toISOString().split('T')[0];\n      this.firebase.saveReflection(date, this.reflections);\n      alert('Reflection saved!');\n    }\n    static {\n      this.ɵfac = function WeeklyReflectionComponent_Factory(t) {\n        return new (t || WeeklyReflectionComponent)(i0.ɵɵdirectiveInject(i1.HabitService), i0.ɵɵdirectiveInject(i2.FirebaseService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: WeeklyReflectionComponent,\n        selectors: [[\"app-weekly-reflection\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 32,\n        vars: 5,\n        consts: [[1, \"reflection\"], [1, \"subtitle\"], [1, \"week-summary\"], [1, \"stat-card\"], [1, \"stat-value\"], [1, \"stat-label\"], [1, \"habits-review\"], [\"class\", \"habit-review-card\", 4, \"ngFor\", \"ngForOf\"], [1, \"reflection-questions\"], [\"class\", \"habit-reflection\", 4, \"ngFor\", \"ngForOf\"], [1, \"save-btn\", 3, \"click\"], [1, \"habit-review-card\"], [1, \"habit-header\"], [1, \"habit-name\"], [1, \"habit-score\"], [1, \"progress-bar\"], [1, \"progress-fill\"], [1, \"habit-identity\"], [1, \"habit-reflection\"], [1, \"question-card\"], [\"rows\", \"2\", \"placeholder\", \"Write your thoughts...\", 3, \"ngModel\", \"ngModelChange\"]],\n        template: function WeeklyReflectionComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"header\")(2, \"h1\");\n            i0.ɵɵtext(3, \"Weekly Reflection\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"p\", 1);\n            i0.ɵɵtext(5, \"Review your habits from the past week\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(6, \"div\", 2)(7, \"div\", 3)(8, \"div\", 4);\n            i0.ɵɵtext(9);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(10, \"div\", 5);\n            i0.ɵɵtext(11, \"Total Votes\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(12, \"div\", 3)(13, \"div\", 4);\n            i0.ɵɵtext(14);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"div\", 5);\n            i0.ɵɵtext(16, \"Consistency\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(17, \"div\", 3)(18, \"div\", 4);\n            i0.ɵɵtext(19);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"div\", 5);\n            i0.ɵɵtext(21, \"Best Streak\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(22, \"div\", 6)(23, \"h2\");\n            i0.ɵɵtext(24, \"Habit Performance\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(25, WeeklyReflectionComponent_div_25_Template, 10, 7, \"div\", 7);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(26, \"div\", 8)(27, \"h2\");\n            i0.ɵɵtext(28, \"Reflection Questions\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(29, WeeklyReflectionComponent_div_29_Template, 15, 4, \"div\", 9);\n            i0.ɵɵelementStart(30, \"button\", 10);\n            i0.ɵɵlistener(\"click\", function WeeklyReflectionComponent_Template_button_click_30_listener() {\n              return ctx.saveReflection();\n            });\n            i0.ɵɵtext(31, \"Save Reflection\");\n            i0.ɵɵelementEnd()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(9);\n            i0.ɵɵtextInterpolate(ctx.totalVotes());\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate1(\"\", ctx.consistencyRate(), \"%\");\n            i0.ɵɵadvance(5);\n            i0.ɵɵtextInterpolate(ctx.bestStreak());\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"ngForOf\", ctx.habits());\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngForOf\", ctx.habits());\n          }\n        },\n        dependencies: [CommonModule, i3.NgForOf, FormsModule, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgModel],\n        styles: [\".reflection[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px}header[_ngcontent-%COMP%]{margin-bottom:32px}h1[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#111827;margin:0 0 4px}h2[_ngcontent-%COMP%]{font-size:20px;font-weight:700;color:#111827;margin:0 0 16px}.subtitle[_ngcontent-%COMP%]{font-size:14px;color:#6b7280;margin:0}.week-summary[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:32px}.stat-card[_ngcontent-%COMP%]{background:white;padding:24px;border-radius:12px;box-shadow:0 2px 8px #00000014;text-align:center}.stat-value[_ngcontent-%COMP%]{font-size:32px;font-weight:700;color:#6366f1;margin-bottom:8px}.stat-label[_ngcontent-%COMP%]{font-size:14px;color:#6b7280}.habits-review[_ngcontent-%COMP%]{background:white;padding:24px;border-radius:12px;box-shadow:0 2px 8px #00000014;margin-bottom:32px}.habit-review-card[_ngcontent-%COMP%]{padding:16px;background:#f9fafb;border-radius:8px;margin-bottom:12px}.habit-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}.habit-name[_ngcontent-%COMP%]{font-size:16px;font-weight:600;color:#111827}.habit-score[_ngcontent-%COMP%]{font-size:18px;font-weight:700;color:#6366f1}.progress-bar[_ngcontent-%COMP%]{height:8px;background:#e5e7eb;border-radius:4px;overflow:hidden;margin-bottom:8px}.progress-fill[_ngcontent-%COMP%]{height:100%;transition:width .3s}.habit-identity[_ngcontent-%COMP%]{font-size:12px;color:#6b7280;font-style:italic}.reflection-questions[_ngcontent-%COMP%]{background:white;padding:24px;border-radius:12px;box-shadow:0 2px 8px #00000014}.habit-reflection[_ngcontent-%COMP%]{margin-bottom:32px;padding-bottom:32px;border-bottom:1px solid #e5e7eb}.habit-reflection[_ngcontent-%COMP%]:last-of-type{border-bottom:none}h3[_ngcontent-%COMP%]{font-size:18px;font-weight:600;color:#111827;margin:0 0 16px}.question-card[_ngcontent-%COMP%]{margin-bottom:24px}label[_ngcontent-%COMP%]{display:block;font-size:15px;font-weight:600;color:#374151;margin-bottom:8px}textarea[_ngcontent-%COMP%]{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:8px;font-size:14px;font-family:inherit;resize:vertical;box-sizing:border-box}textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#6366f1}.save-btn[_ngcontent-%COMP%]{width:100%;padding:14px;background:#6366f1;color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer}.save-btn[_ngcontent-%COMP%]:hover{background:#4f46e5}@media (max-width: 640px){.week-summary[_ngcontent-%COMP%]{grid-template-columns:1fr}}\"]\n      });\n    }\n  }\n  return WeeklyReflectionComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}